<!doctype html>
<html lang="en"
    class="h-full antialiased"
    style="--header-position:sticky; --header-height:64px; --header-mb:0px; --header-top:0px; --avatar-top:0px;">
    <head>
        <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>GreenThumb Leaf Area Analysis | Justin Bowen is TonsOfFun</title>

<meta name="description" content="Write an awesome description for your new site here. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />

<link rel="apple-touch-icon" sizes="180x180" href="/images/icons/system/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/icons/system/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/icons/system/favicon-16x16.png">
<link rel="manifest" href="/images/icons/system/site.webmanifest">
<link rel="stylesheet" href="/_bridgetown/static/index.22CSXFI2.css" />
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.1/dist/cdn.min.js"></script>
<script src="/_bridgetown/static/index.RARUY3ZT.js" defer></script>

<script>
  let darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)')

  updateMode()
  darkModeMediaQuery.addEventListener('change', updateModeWithoutTransitions)
  window.addEventListener('storage', updateModeWithoutTransitions)

  function updateMode() {
    let isSystemDarkMode = darkModeMediaQuery.matches
    let isDarkMode = window.localStorage.isDarkMode === 'true' || (!('isDarkMode' in window.localStorage) && isSystemDarkMode)
    
    if (isDarkMode) {
      document.documentElement.classList.add('dark')
    } else {
      document.documentElement.classList.remove('dark')
    }

    if (isDarkMode === isSystemDarkMode) {
      delete window.localStorage.isDarkMode
    }
  }

  function disableTransitionsTemporarily() {
    document.documentElement.classList.add('[&_*]:!transition-none')
    window.setTimeout(() => {
      document.documentElement.classList.remove('[&_*]:!transition-none')
    }, 0)
  }

  function updateModeWithoutTransitions() {
    disableTransitionsTemporarily()
    updateMode()
  }

  function toggleMode() {
    disableTransitionsTemporarily()

    let darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)')
    let isSystemDarkMode = darkModeMediaQuery.matches
    let isDarkMode = document.documentElement.classList.toggle('dark')

    if (isDarkMode === isSystemDarkMode) {
      delete window.localStorage.isDarkMode
    } else {
      window.localStorage.isDarkMode = isDarkMode
    }
  }

  function toggleDarkMode() {
    return {
      updateLightDarkMode() {
        toggleMode()
      }
    }
  }
  
  function scrollToShow() {
    return {
      sticky: false,
      lastPos: window.scrollY + 0,
      downDelay: ('post' == 'home' ? document.querySelector("div[x-ref='avatar']").offsetTop : 0),
      upDelay: 64,
      home: ('post' == 'home'), 
      scrollMenu() {        
        let downDelay = this.downDelay;
        let { top, height } = this.$refs.navbar.getBoundingClientRect()
        let upDelay = this.upDelay;
        let scrollY = clamp(
          window.scrollY,
          0,
          document.body.scrollHeight - window.innerHeight
        )
        
        if (this.sticky) {
          setProperty('--header-position', 'sticky')
        }

        setProperty('--content-offset', `${downDelay}px`)

        if (this.sticky || scrollY < downDelay) {
          setProperty('--header-height', `${downDelay + height}px`)
          setProperty('--header-mb', `${-downDelay}px`)
        } else if (top + height < -upDelay) {
          let offset = Math.max(height, scrollY - upDelay);
          setProperty('--header-height', `${offset}px`)
          setProperty('--header-mb', `${height - offset}px`)
        } else if (top === 0) {
          setProperty('--header-height', `${scrollY + height}px`)
          setProperty('--header-mb', `${-scrollY}px`)
        }

        if (top === 0 && scrollY > 0 && scrollY >= downDelay) {
          setProperty('--header-inner-position', 'fixed')
          removeProperty('--header-top')
          removeProperty('--avatar-top')
        } else {
          removeProperty('--header-inner-position')
          setProperty('--header-top', '0px')
          setProperty('--avatar-top', '0px')
        }
      },
      updateAvatarStyles() {
        if (!this.home) {
          return
        }

        let downDelay = this.downDelay;
        let fromScale = 1
        let toScale = 36 / 64
        let fromX = 0
        let toX = 2 / 16

        let scrollY = downDelay - window.scrollY
        console.log('scrollY', scrollY);

        let scale = (scrollY * (fromScale - toScale)) / downDelay + toScale
        scale = clamp(scale, fromScale, toScale)
        console.log('scale', scale);

        let x = (scrollY * (fromX - toX)) / downDelay + toX
        x = clamp(x, fromX, toX)
        console.log('x', x);

        let borderScale = 1 / (toScale / scale)
        let borderX = (-toX + x) * borderScale
        let borderTransform = `translate3d(${borderX}rem, 0, 0) scale(${borderScale})`

        setProperty('--avatar-image-transform', `translate3d(${x}rem, 0, 0) scale(${scale})`)

        setProperty('--avatar-border-transform', borderTransform)
        setProperty('--avatar-border-opacity', scale === toScale ? 1 : 0)
      }
    }
  }


  function clamp(number, a, b) {
    let min = Math.min(a, b)
    let max = Math.max(a, b)
    return Math.min(Math.max(number, min), max)
  }

  function setProperty(property, value) {
    document.documentElement.style.setProperty(property, value)
  }

  function removeProperty(property) {
    document.documentElement.style.removeProperty(property)
  }
</script>
<script type="module">let lastmod = 0
function startReloadConnection() {
  const evtSource = new EventSource("/_bridgetown/live_reload")
  evtSource.onmessage = event => {
    if (document.querySelector("#bridgetown-build-error")) document.querySelector("#bridgetown-build-error").close()
    if (event.data == "reloaded!") {
      location.reload()
    } else {
      const newmod = Number(event.data)
      if (lastmod > 0 && newmod > 0 && lastmod < newmod) {
        location.reload()
      } else {
        lastmod = newmod
      }
    }
  }
  evtSource.addEventListener("builderror", event => {
    let dialog = document.querySelector("#bridgetown-build-error")
    if (!dialog) {
      dialog = document.createElement("dialog")
      dialog.id = "bridgetown-build-error"
      dialog.style.borderColor = "red"
      dialog.style.fontSize = "110%"
      dialog.innerHTML = `
        <p style="color:red">There was an error when building the site:</p>
        <output><pre></pre></output>
        <p><small>Check your Bridgetown logs for further details.</small></p>
      `
      document.body.appendChild(dialog)
      dialog.showModal()
    }
    dialog.querySelector("pre").textContent = JSON.parse(event.data)
  })
  evtSource.onerror = event => {
    if (evtSource.readyState === 2) {
      // reconnect with new object
      evtSource.close()
      console.warn("Live reload: attempting to reconnect in 3 seconds...")

      setTimeout(() => startReloadConnection(), 3000)
    }
  }
}
setTimeout(() => {
  startReloadConnection()
}, 500)
</script>

    </head>

    <body class="flex h-full flex-col bg-zinc-50 dark:bg-black  post ">
        <div id="__next">
            <div class="fixed inset-0 flex justify-center sm:px-8">
                <div class="flex w-full max-w-7xl lg:px-8">
                    <div class="w-full bg-white ring-1 ring-zinc-100 dark:bg-zinc-900 dark:ring-zinc-300/20"></div>
                </div>
            </div>
            <div class="relative">
                <header x-data="{
      open: false,
      get isOpen() { return this.open },
      toggleMenu() { this.open = ! this.open },
    }" 
    class="relative z-50 flex flex-col pointer-events-none print:hidden"
    style="height:var(--header-height);margin-bottom:var(--header-mb)">
    <div class="order-last mt-[calc(theme(spacing.16)-theme(spacing.3))]"></div>
    <div class="top-0 order-last pt-3 -mb-3 sm:px-8 hidden" style="position: var(--header-position);" 
        x-data="scrollToShow()" 
        x-on:scroll.window.passive="updateAvatarStyles()"
        x-ref="avatar">
        <div class="mx-auto max-w-7xl lg:px-8">
            <div class="relative px-4 sm:px-8 lg:px-12">
                <div class="max-w-2xl mx-auto lg:max-w-5xl">
                    <div class="top-[var(--avatar-top,theme(spacing.3))] w-full" style="position: var(--header-inner-position);">
                        <div class="relative">
                            <div class="absolute left-0 top-3 origin-left transition-opacity h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:ring-white/10" style="opacity: var(--avatar-border-opacity, 0); transform: var(--avatar-border-transform);"></div>
                            <a aria-label="Home" class="block w-16 h-16 origin-left pointer-events-auto" href="/" style="transform: var(--avatar-image-transform);">
                                <img alt="" sizes="4rem" srcset="https://res.cloudinary.com/tonsoffun/image/upload/w_600,c_limit,q_85/v1666727171/avatar_oo5ahy.jpg" src="https://res.cloudinary.com/tonsoffun/image/upload/w_1800,c_limit,q_80/v1666727171/avatar_oo5ahy.jpg" width="1280" height="1280" decoding="async" data-nimg="future" class="object-cover w-16 h-16 rounded-full bg-zinc-100 dark:bg-zinc-800" style="color: transparent;">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div x-data="scrollToShow()" 
        x-on:scroll.window.passive="scrollMenu()"
        x-init="scrollMenu()"
        class="top-0 z-10 h-16 pt-6"
        x-ref="navbar"
        style="position:var(--header-position)">
        <div class="sm:px-8 top-[var(--header-top,theme(spacing.6))] w-full"
            style="position:var(--header-inner-position)">
            <div class="mx-auto max-w-7xl lg:px-8">
                <div class="relative px-4 sm:px-8 lg:px-12">
                    <div class="max-w-3xl mx-auto lg:max-w-5xl">
                        <div class="relative flex gap-4" style="">
                            <div class="flex flex-1">
                                <div class=" m-1 h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:ring-white/10">
                                    <a aria-label="Home" class="pointer-events-auto mx-18" href="/">
                                        <img alt=""
                                            sizes="2.25rem"
                                            srcset=""
                                            x-ref="avatar"
                                            src="https://res.cloudinary.com/tonsoffun/image/upload/w_600,c_limit,q_85/v1666727171/avatar_oo5ahy.jpg"
                                            width="512" height="512" decoding="async" data-nimg="future"
                                            class="object-cover rounded-full bg-zinc-100 dark:bg-zinc-800 h-9 w-9"
                                            style="color: transparent;">
                                    </a>
                                </div>
                            </div>
                            <div class="flex justify-end flex-1 md:justify-center">
                                <div @click="toggleMenu" class="pointer-events-auto md:hidden">
                                    <div x-show="isOpen">
                                        <div class="fixed inset-0 z-50 opacity-100 bg-zinc-800/40 backdrop-blur-sm dark:bg-black/80" aria-hidden="true"></div>
                                        <div class="fixed z-50 p-8 origin-top scale-100 bg-white opacity-100 inset-x-4 top-8 rounded-3xl ring-1 ring-zinc-900/5 dark:bg-zinc-900 dark:ring-zinc-800" tabindex="-1">
                                            <div class="flex flex-row-reverse items-center justify-between">
                                                <button aria-label="Close menu" class="p-1 -m-1" type="button" tabindex="0">
                                                    <svg viewBox="0 0 24 24" aria-hidden="true" class="w-6 h-6 text-zinc-500 dark:text-zinc-400">
                                                        <path d="m17.25 6.75-10.5 10.5M6.75 6.75l10.5 10.5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                                    </svg>
                                                </button>
                                                <h2 class="text-sm font-medium text-zinc-600 dark:text-zinc-400">Navigation</h2>
                                            </div>
                                            <nav class="mt-6">
                                                <ul class="-my-2 text-base divide-y divide-zinc-100 text-zinc-800 dark:divide-zinc-100/5 dark:text-zinc-300">
                                                        <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/">
            Home
        </a>
</li>

                                                        <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/about">
            About
        </a>
</li>

                                                        <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/blog">
            Blog
        </a>
</li>

                                                        <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/career/">
            Career
        </a>
</li>

                                                        <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/life">
            Life
        </a>
</li>

                                                        <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/projects">
            Projects
        </a>
</li>

                                                        <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/skills">
            Skills
        </a>
</li>

                                                        <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/speaking">
            Speaking
        </a>
</li>

                                                </ul>
                                            </nav>
                                        </div>
                                    </div>
                                    <button aria-controls="mobile-menu" aria-expanded="false"
                                        class="flex items-center px-4 py-2 text-sm font-medium rounded-full shadow-lg group bg-white/90 text-zinc-800 shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:text-zinc-200 dark:ring-white/10 dark:hover:ring-white/20"
                                        type="button">Menu
                                        <svg viewBox="0 0 8 6" aria-hidden="true"
                                            class="w-2 h-auto ml-3 stroke-zinc-500 group-hover:stroke-zinc-700 dark:group-hover:stroke-zinc-400">
                                            <path d="M1.75 1.75 4 4.25l2.25-2.5" fill="none" stroke-width="1.5"
                                                stroke-linecap="round" stroke-linejoin="round"></path>
                                        </svg>
                                    </button>
                                </div>
                                <nav class="hidden pointer-events-auto md:block">
                                    <ul class="flex px-3 text-sm font-medium rounded-full shadow-lg bg-white/90 text-zinc-800 shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:text-zinc-200 dark:ring-white/10">
                                            <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/">
            Home
        </a>
</li>

                                            <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/about">
            About
        </a>
</li>

                                            <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/blog">
            Blog
        </a>
</li>

                                            <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/career/">
            Career
        </a>
</li>

                                            <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/life">
            Life
        </a>
</li>

                                            <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/projects">
            Projects
        </a>
</li>

                                            <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/skills">
            Skills
        </a>
</li>

                                            <li>
        <a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400"
            href="/speaking">
            Speaking
        </a>
</li>

                                    </ul>
                                </nav>
                            </div>
                            <div class="flex justify-end md:flex-1">
                                <div class="pointer-events-auto">
                                    <button type="button" aria-label="Toggle dark mode"
                                        class="px-3 py-2 transition rounded-full shadow-lg group bg-white/90 shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:ring-white/10 dark:hover:ring-white/20"
                                         x-data="toggleDarkMode()" @click="updateLightDarkMode" aria-label="Toggle Darkmode">
                                        <svg
                                            viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round"
                                            stroke-linejoin="round" aria-hidden="true"
                                            class="h-6 w-6 fill-zinc-100 stroke-zinc-500 transition group-hover:fill-zinc-200 group-hover:stroke-zinc-700 dark:hidden [@media(prefers-color-scheme:dark)]:fill-teal-50 [@media(prefers-color-scheme:dark)]:stroke-teal-500 [@media(prefers-color-scheme:dark)]:group-hover:fill-teal-50 [@media(prefers-color-scheme:dark)]:group-hover:stroke-teal-600">
                                            <path
                                                d="M8 12.25A4.25 4.25 0 0 1 12.25 8v0a4.25 4.25 0 0 1 4.25 4.25v0a4.25 4.25 0 0 1-4.25 4.25v0A4.25 4.25 0 0 1 8 12.25v0Z">
                                            </path>
                                            <path
                                                d="M12.25 3v1.5M21.5 12.25H20M18.791 18.791l-1.06-1.06M18.791 5.709l-1.06 1.06M12.25 20v1.5M4.5 12.25H3M6.77 6.77 5.709 5.709M6.77 17.73l-1.061 1.061"
                                                fill="none"></path>
                                        </svg>
                                        <svg viewBox="0 0 24 24" aria-hidden="true"
                                            class="hidden h-6 w-6 fill-zinc-700 stroke-zinc-500 transition dark:block [@media(prefers-color-scheme:dark)]:group-hover:stroke-zinc-400 [@media_not_(prefers-color-scheme:dark)]:fill-teal-400/10 [@media_not_(prefers-color-scheme:dark)]:stroke-teal-500">
                                            <path
                                                d="M17.25 16.22a6.937 6.937 0 0 1-9.47-9.47 7.451 7.451 0 1 0 9.47 9.47ZM12.75 7C17 7 17 2.75 17 2.75S17 7 21.25 7C17 7 17 11.25 17 11.25S17 7 12.75 7Z"
                                                stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                            </path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

                <main>
                    <div class="mt-16 sm:px-8 lg:mt-32">
    <div class="mx-auto max-w-7xl lg:px-8">
        <div class="relative px-4 sm:px-8 lg:px-12">
            <div class="max-w-2xl mx-auto lg:max-w-5xl">
                <div class="xl:relative">
                    <div class="max-w-2xl mx-auto">
                        <article>
                            <header class="flex flex-col">
                                <h1 class="mt-6 text-4xl font-bold tracking-tight text-zinc-800 dark:text-zinc-100 sm:text-5xl">
                                    GreenThumb Leaf Area Analysis
                                </h1>
                                
                                <time datetime="March 1, 2015" class="flex items-center order-first text-base text-zinc-400 dark:text-zinc-500">
                                    <span class="h-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"></span>
                                    <span class="ml-3">March 1, 2015</span>
                                </time>
                                <div>
    <a href="/tags/opencv" class="inline-flex items-center rounded-full bg-gray-400/10 px-1.5 py-0.5 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10">OpenCV</a>
    <a href="/tags/python" class="inline-flex items-center rounded-full bg-blue-400/10 px-1.5 py-0.5 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-700/10">Python</a>
    <a href="/tags/greenthumb" class="inline-flex items-center rounded-full bg-gray-400/10 px-1.5 py-0.5 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10">greenthumb</a>
    <a href="/tags/googlecolab" class="inline-flex items-center rounded-full bg-gray-400/10 px-1.5 py-0.5 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10">GoogleColab</a>
    <a href="/tags/docker" class="inline-flex items-center rounded-full bg-gray-400/10 px-1.5 py-0.5 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10">Docker</a>
    <a href="/tags/ipythonnotebook" class="inline-flex items-center rounded-full bg-gray-400/10 px-1.5 py-0.5 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10">iPythonNotebook</a>
    <a href="/tags/matplotlib" class="inline-flex items-center rounded-full bg-gray-400/10 px-1.5 py-0.5 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10">matplotlib</a>
</div>
                            </header>
                            
                            <div class="mt-8 prose dark:prose-invert">
                                <blockquote>
  <p>This blog was originally published on <a href="https://medium.com/greenthumbio/cannabis-leaf-area-analysis-d6449dbda07f">Medium</a>.</p>
</blockquote>

<h2 id="intro">Intro</h2>

<p>In this post I’m going to show you how to use openCV and some basic HSV color space analysis used to mask out non leaf pixels. We can use the mask to measure the leaf area in pixels. You can use basic trig to find out the pixel to millimeter value using the distance and angle of the field of view. I’ve broken my Jupiter notebook into smaller pieces to overcome the limitations of medium’s support for rendering long notebooks (though it did seem to render fine on mobile, I couldn’t see it properly on my MacBook Pro using Chrome). Anyway, I also have a full version of the <a href="https://gist.github.com/TonsOfFun/9ed35c29de2ef32884b7e5cea4144c2e">notebook</a> available for anyone interested.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*IjHOnf9J_k7-kbel4AXEKA.jpeg" alt="Leaf Area Analysis" /></p>

<h2 id="dependencies">Dependencies</h2>
<p>We’re going to utilize the imutils convenience package to resize the images for processing as well as for finding our HSV calibration values. OpenCV will be used for preprocessing the image and pixel selection by range. We use matplotlib is used from rendering images and graphs.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">imutils</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span> 
</code></pre></div></div>

<h2 id="leaf-masking">Leaf Masking</h2>
<p>This is a basic function that converts the BGR (OpenCV is BGR, not RGB) image to HSV. Using the <code class="highlighter-rouge">leaf_lower</code> and <code class="highlighter-rouge">leaf_upper</code> HSV colorspace values defined using the range-detector helper tool found in imutils. These calibration settings work on both of my NestCams situated under the same type of HPS light. This is basically pulled from this PyImageSearch article on tracking a green ball.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># Defined bounds using https://github.com/jrosebr1/imutils/blob/master/bin/range-detector
</span><span class="n">leaf_lower</span> <span class="o">=</span> <span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">leaf_upper</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">leaf_mask</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">):</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">imutils</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">bgr_image</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">blurred</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">hsv</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">blurred</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span>

    <span class="c1"># construct a mask for the color "green", then perform
</span>    <span class="c1"># a series of dilations and erosions to remove any small
</span>    <span class="c1"># blobs left in the mask
</span>    <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">hsv</span><span class="p">,</span> <span class="n">leaf_lower</span><span class="p">,</span> <span class="n">leaf_upper</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">erode</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mask</span>
</code></pre></div></div>

<p>The erosions and dilations are to cleanup any smaller blobs picked up by the HSV range. In the next blogpost we will go over how to do additional filtering by analyzing the contours and their sizes. I’m not going to apply that here since the results of the post processing on the mask seem adequate for this stage. We will be replacing this model with a custom trained TensorFlow maks RCNN model. Checkout this blogpost on making a toy detector that can output a pixel-wise mask.</p>

<script src="https://gist.github.com/TonsOfFun/e2e283b3a229a898e0fae217c276e48b.js"></script>

<p>You can see the function working on the two sample images, above from week one and below from week 2. They represent the plants at two time periods 5 days apart. Now let’s checkout what insights the data has to offer.</p>

<script src="https://gist.github.com/TonsOfFun/ececab5fd38f1db618847e7431a284f2.js"></script>

<h2 id="health-reports-andgraphs">Health Reports and Graphs</h2>
<p>Below you can checkout a leaf growth report. 10 square inches or 30 square centimeters of growth assuming our camera was hung at the correct height and give or take some variance due to inconsistent leaf distances from the lens. This gives a cultivator great insight into the general health of their crop just by graphing growth. You might also notice that I scaled the images down for processing so the results would have to be scaled up proportionately. That’s an exercise for another time as this post is just to get the concept of monitoring and graphing plant growth with smart cameras.</p>

<p>We can now have the ability to provide reports on performance as well as alerts when growth has plateaued or even dropped off which is a clear sign of stress in any plant. We can also provide historical performance reviews so a cultivator can see how the current crop is vegging in comparison with previous crops at the same stage of growth.
Let’s plot these data points from our two leaf area analyses. Since we only have our two data points from this time series our line graph will be a little boring, but you can imagine the growth being more engaging when plotting a point every minute instead of every 5 days. A realtime growth chart would include oscillations from the circadian rhythms induced by the light cycles, as well as fluctuating from variable environmental conditions. The decentralized AI will have to compensate for variability dynamically at each camera.</p>

<script src="https://gist.github.com/TonsOfFun/4b4a7a0f6d4708ba46a89c457c41a115.js"></script>

<p>With this functionality we increase the farmers awareness of problem areas in there grow sites and give them metrics to back their business’s performance overtime. We can now take photos of cannabis plants and produce metrics on our devices. It’s the first step on our path to a decentralized cannabis AI and there is enormous potential value in a trusted data source of cannabis cultivation metrics from seed to harvest. I’ll be putting out an article later this month talking about GreenThumb IO’s plans to empower the farmers with their own crop data with GTIO Security Tokens.</p>

<script src="https://gist.github.com/TonsOfFun/9ed35c29de2ef32884b7e5cea4144c2e.js"></script>

<p><img src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*jc0efTe4Ug77dOpmlj4T3A.jpeg" alt="cannabis leaves" /></p>

                            </div>
                        </article>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
                </main>
                <footer class="mt-32 print:hidden">
    <div class="sm:px-8">
        <div class="mx-auto max-w-7xl lg:px-8">
            <div class="pt-10 pb-16 border-t border-zinc-100 dark:border-zinc-700/40">
                <div class="flex justify-center mb-4 space-x-6">
                        <a class="font-semibold group -m-1 p-1" href="https://github.com/TonsOfFun" aria-label="Follow me on GitHub" target="_blank" rel="noopener noreferrer">    
                <svg fill="currentColor" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M12 .3C5.4.3 0 5.7 0 12.3c0 5.3 3.4 9.8 8.2 11.4.6.1.8-.3.8-.6v-2c-3.3.7-4-1.6-4-1.6-.5-1.4-1.3-1.8-1.3-1.8-1.2-.7 0-.7 0-.7 1.2.1 1.8 1.2 1.8 1.2 1.1 1.8 2.8 1.3 3.5 1 .1-.8.4-1.3.8-1.6-2.7-.3-5.5-1.3-5.5-5.9 0-1.3.5-2.4 1.2-3.2 0-.4-.5-1.6.2-3.2 0 0 1-.3 3.3 1.2 1-.3 2-.4 3-.4s2 .1 3 .4c2.3-1.6 3.3-1.2 3.3-1.2.7 1.7.2 2.9.1 3.2.8.8 1.2 1.9 1.2 3.2 0 4.6-2.8 5.6-5.5 5.9.4.4.8 1.1.8 2.2v3.3c0 .3.2.7.8.6 4.8-1.6 8.2-6.1 8.2-11.4C24 5.7 18.6.3 12 .3z"/>
</svg>            

                <span class="sr-only">Follow me on GitHub</span>

</a>    <a class="font-semibold group -m-1 p-1" href="https://twitter.com/TonsOfFun111" aria-label="Follow me on Twitter" target="_blank" rel="noopener noreferrer">    
                <svg class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M24 4.6c-.9.4-1.8.7-2.8.8 1-.6 1.8-1.6 2.2-2.7-1 .6-2 1-3.1 1.2-.9-1-2.2-1.6-3.6-1.6-2.7 0-4.9 2.2-4.9 4.9 0 .4 0 .8.1 1.1-4.2-.2-7.8-2.2-10.2-5.2-.5.8-.7 1.6-.7 2.5 0 1.7.9 3.2 2.2 4.1-.8 0-1.6-.2-2.2-.6v.1c0 2.4 1.7 4.4 3.9 4.8-.4.1-.8.2-1.3.2-.3 0-.6 0-.9-.1.6 2 2.4 3.4 4.6 3.4-1.7 1.3-3.8 2.1-6.1 2.1-.4 0-.8 0-1.2-.1 2.2 1.4 4.8 2.2 7.5 2.2 9.1 0 14-7.5 14-14v-.6c1-.7 1.8-1.6 2.5-2.5z"/>
</svg>            

                <span class="sr-only">Follow me on Twitter</span>

</a>    <a class="font-semibold group -m-1 p-1" href="https://linkedin.com/in/TonsOfFun111" aria-label="Connect with me on LinkedIn" target="_blank" rel="noopener noreferrer">    
                <svg fill="currentColor" viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M23,0H1C0.4,0,0,0.4,0,1v22c0,0.6,0.4,1,1,1h22c0.6,0,1-0.4,1-1V1C24,0.4,23.6,0,23,0z M7.1,20.5H3.6V9h3.6 V20.5z M5.3,7.4c-1.1,0-2.1-0.9-2.1-2.1c0-1.1,0.9-2.1,2.1-2.1c1.1,0,2.1,0.9,2.1,2.1C7.4,6.5,6.5,7.4,5.3,7.4z M20.5,20.5h-3.6 v-5.6c0-1.3,0-3-1.8-3c-1.9,0-2.1,1.4-2.1,2.9v5.7H9.4V9h3.4v1.6h0c0.5-0.9,1.6-1.8,3.4-1.8c3.6,0,4.3,2.4,4.3,5.5V20.5z"/>
</svg>            

                <span class="sr-only">Connect with me on LinkedIn</span>

</a>    <a class="font-semibold group -m-1 p-1" href="https://Instagram.com/TonsOfFun111" aria-label="Follow me on Instagram" target="_blank" rel="noopener noreferrer">    
                <svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 24 24" class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300" aria-hidden="true">
  <title>Instagram</title>
  <path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"/>
</svg>            

                <span class="sr-only">Follow me on Instagram</span>

</a>    <a class="font-semibold group -m-1 p-1" href="https://discordapp.com/users/569074648772509698" aria-label="Connect on Discord" target="_blank" rel="noopener noreferrer">    
                <svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 24 24" class="h-6 w-6 fill-zinc-500 transition group-hover:fill-zinc-600 dark:fill-zinc-400 dark:group-hover:fill-zinc-300" aria-hidden="true">
  <title>Discord</title>
  <path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"/>
</svg>            

                <span class="sr-only">Connect on Discord</span>

</a>
                </div>
                <div class="relative px-4 sm:px-8 lg:px-12">
                    <div class="max-w-2xl mx-auto lg:max-w-5xl">
                        <div class="flex flex-col items-center justify-between gap-6 sm:flex-row">
                            <div class="flex gap-6 text-sm font-medium text-zinc-800 dark:text-zinc-200">
                              <a class="transition hover:text-teal-500 dark:hover:text-teal-400"
                                href="/about">About</a>
                              <a class="transition hover:text-teal-500 dark:hover:text-teal-400"
                                href="/projects">Projects</a>
                              <a class="transition hover:text-teal-500 dark:hover:text-teal-400"
                                href="/speaking">Speaking</a>
                              <a class="transition hover:text-teal-500 dark:hover:text-teal-400"
                                href="/skills">Skills</a>
                            </div>

                            <p class="text-sm text-zinc-400 dark:text-zinc-500">©
                                <!-- --><script>document.write( new Date().getFullYear() );</script>
                                <!-- --> Justin Bowen. All rights reserved.
                            </p>

                            <p class="text-sm text-center">
                            <a class="hover:text-teal-500 dark:hover:text-teal-400 font-semibold text-zinc-800 dark:text-zinc-200 transition hover:text-teal-500 dark:hover:text-teal-400 after:content-[&#39;_↗&#39;]" href="https://github.com/tonsoffun/tonsoffun.github.io/blob/main/src/_posts/greenthumb/leaf-area.md" target="_blank" rel="noopener noreferrer">Edit on GitHub</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

            </div>
        </div>
    </body>
</html>